/*
Больница
1.Doctors/Врачи: ID врача, ФИО, должность, специализация, стаж работы, адрес, телефон.
2.Diagnoses/Диагнозы - ID диагноза, название заболевания, id лекарства 
3.Patients/Пациенты – ID пациента, ФИО, адрес, телефон, страховой полис, паспорт.
4.Departments/Отделения: ID отделения, название отделения, заведующий (fk на id врачей), количество койкомест
5.Medicines/Лекарства: ID лекарства, название, описание
6.PatientReception/Прием больных: ID посещения, id пациента, id диагноза, id отделения, id врача, 
дата обращения, дата выписки

Найти больных, которые повторно обратились в больницу c тем же диагнозом в течение одного года. Вывести все посещения, 
а для них: больного, диагноз, дату, врача.

*/

SELECT 
    pt.ФИО AS Пациент, 
    dg.название заболевания AS Диагноз, 
    pr1.дата обращения AS Дата_обращения, 
    doc.ФИО AS Врач
FROM 
    PatientReception pr1
    JOIN Patients pt ON pr1.PatientsID = pt.PatientsID
    JOIN Diagnoses dg ON pr1.DiagnosesID = dg.DiagnosesID
    JOIN Doctors doc ON pr1.DoctorsID = doc.DoctorsID
    JOIN PatientReception pr2 ON pr1.PatientsID = pr2.PatientsID 
        AND pr1.DiagnosesID = pr2.DiagnosesID 
        AND pr1.ID_посещения <> pr2.ID_посещения                  
        AND DATEDIFF(day, pr1.дата обращения, pr2.дата обращения) BETWEEN 1 AND 365  -- <=365
ORDER BY 
    pt.ФИО, pr1.дата обращения;

Задание №2.

График кто чаще обращается в салоны мужчины или женщины, какими услугами чаще пользуются, какие услуги приносят больше выручку, какие мастера дают основную выручку по месяцам их доля в общем объеме. 

